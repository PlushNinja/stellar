.panel.panel-primary
  .panel-heading
    %h4.panel-title
      = @payment_gateway.order.order_type
      .pull-right
        = icon('cc-visa', class: 'fa-lg')
        = icon('cc-mastercard', class: 'fa-lg')
  .panel-body
    = bootstrap_form_tag url: pay_path(method: :credit_card), html: {id: 'paybyway-creditcard-form'} do |f|
      .row
        .col-sm-6
          = f.text_field :number, value: '4012888888881881', label: t('store.checkout.card_number')
        .col-sm-3
          = f.text_field :expiry, value: '12/17', label: t('store.checkout.card_expiry')
        .col-sm-3
          = f.text_field :cvc, value: '777', label: t('store.checkout.card_cvc')
        .col-xs-12
          = f.button t('store.checkout.charge'), class: 'btn btn-block btn-lg btn-primary'
      .row
        .col-xs-12.working.collapse
          %p
            .pull-right= icon('circle-o-notch', class: 'fa-lg fa-spin')
            = t('store.checkout.charging')

:coffee
  $('#paybyway-creditcard-form').on 'submit', (e) ->
    e.preventDefault()
    $(this).find('button').attr 'disabled', true
    $('.working').collapse 'show'
    $.get($(this).attr 'action').done (data) ->
      token = data.token
      amount = data.amount
      number = $('#number').val()
      [exp_month, exp_year] = $('#expiry').val().split '/'
      cvc = $('#cvc').val()
