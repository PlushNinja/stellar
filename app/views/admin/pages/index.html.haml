.page-header
  - if current_user.can_create?(Page)
    = link_to new_admin_page_path, class: 'btn btn-primary' do
      = icon('plus', 'New page')
  %h1= icon('files-o', 'Pages')

.table-responsive
  %table.table.table-striped.table-hover.table-loose
    %thead
      %tr
        %th.col-xs-4 Title
        %th.col-xs-4 Parent page
        %th.hidden-print

    %tbody{class: current_user.can_update?(Page) ? 'sortable' : nil}
      = content_tag_for :tr, @pages do |page|
        %td= page.title
        %td= page.parent_page
        %td.hidden-print.text-right
          = link_to icon('eye', t('actions.view')), show_page_path(page),
              class: 'btn btn-default btn-sm'
          - if current_user.can_update?(Page)
            = link_to icon('edit', t('actions.edit')), edit_admin_page_path(page),
                class: 'btn btn-default btn-sm'
          - if current_user.can_delete?(Page)
            = link_to icon('remove', t('actions.delete')), admin_page_path(page),
                method: :delete, class: 'btn btn-sm btn-danger',
                data: {confirm: "Delete page #{page.title}?"}

:coffee
  $('.sortable').sortable(
    items: 'tr'
    placeholder: '#{tr_placeholder(3)}'
  ).bind 'sortupdate', (e, ui) ->
    $.post '#{reorder_admin_pages_path}',
      {reorder: $('tr', this).map(-> this.id).get()}
