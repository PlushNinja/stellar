#order-item-form
  = bootstrap_form_for [:pos, order, OrderItem.new(amount: 1)], remote: true do |f|
    %fieldset
      .row
        .col-sm-9
          = f.select :product_id, [], {skip_label: true}, {placeholder: title(Product), class: 'selectize-tall selectize-list-group'}
        .col-sm-3
          = f.number_field :amount, min: 1, max: 999, skip_label: true, placeholder: col(OrderItem, :amount)
      .row
        .col-sm-5
          = f.select :inventory_item_id, [], {skip_label: true}, {placeholder: col(OrderItem, :inventory_item_id), class: 'selectize'}
        .col-sm-4
          = f.select :inventory_entry_id, [], {skip_label: true}, {placeholder: col(OrderItem, :inventory_entry_id), class: 'selectize'}
        .col-sm-3
          = f.button class: 'btn btn-block btn-primary' do
            = icon('check')

:coffee
  $('#order_item_product_id').selectize
    dropdownParent: 'body'
    valueField: 'id'
    sortField: [{field: 'title'}, {field: 'subtitle'}]
    searchField: ['code', 'customer_code', 'title', 'subtitle']
    diacritics: false
    render: $.fn.selectize.product_renderer
    load: (query, callback) ->
      return callback() unless query
      $.ajax
        url: '#{query_admin_products_path}'
        type: 'GET'
        dataType: 'json'
        data:
          q: query
          purposes: ['vanilla', 'composite']
        error: ->
          callback()
        success: (response) ->
          callback(response)
