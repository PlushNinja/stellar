#section-list.section-list.layout-container.sortable{data: {sections: @page.sections.map { |section| preload_admin_section_path(section) }.as_json}}
  = render partial: 'admin/sections/loader', collection: @page.sections, as: :section

- content_for :secondary_nav do
  .container
    %ul.nav.navbar-nav.navbar-right.page-controls
      %li
        = link_to show_page_path(@page) do
          = icon('eye', t('actions.show'))
      - if current_user.can_create?(Section, at: current_store)
        = render partial: 'layout_menu'
      %li
        = link_to edit_admin_page_path(@page) do
          = icon('chevron-circle-left', t('actions.back'))
    %ul.nav.navbar-nav.navbar-right.segment-controls
      %li
        %button.btn.navbar-btn.btn-default{type: 'button'}
          = icon('close', t('actions.cancel'))
      %li
        %button#segment-save.btn.navbar-btn.btn-primary{type: 'button'}
          = icon('check', t('actions.save'))
    .navbar-toolbar

:coffee
  $('.segment-controls').hide()

  for section in $('#section-list').data 'sections'
    $.get section

  $('#section-list').sortable(
    items: '> .section-list-item'
    handle: '.handle'
    placeholder: 'sortable-placeholder'
    forcePlaceholderSize: true
    opacity: 0.5
    revert: 200
  ).bind 'sortupdate', (e, ui) ->
    if $(e.target).hasClass 'section-list'
      $.post '#{reorder_admin_page_sections_path(@page)}',
        {reorder: $(this).sortable('toArray')}

  $(document).on 'pictureable:added pictureable:changed pictureable:removed pictureable:reordered documentable:added documentable:removed documentable:reordered', ->
    $('#editor-panel').find('form.triggered').trigger 'submit.rails'

  $('#content-wrap').on 'click', ->
    $('.section, .column, .segment').removeClass 'active';
    $('#editor-panel').destroySelectized();
    $('#side-panel').removeClass 'open'

  $('#side-panel').on 'hidden.offcanvas', (e) ->
    $('.section, .column, .segment').removeClass('active');
