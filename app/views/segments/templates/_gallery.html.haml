.segment-content.gallery{id: dom_id(gallery, :content)}
  - if gallery.images.any?
    .grid.thumbnail-grid{class: "grid-columns-#{gallery.grid_columns || 3}"}
      - gallery.images.each do |image|
        .grid-item
          - if gallery.thumbnails?
            = link_to image.url(:lightbox, timestamp: false), class: 'image-link' do
              .thumbnail
                = image_variant_tag image, :technical
          - else
            .image-container{class: gallery.image_sizing}
              = image_variant_tag image, :technical
  - else
    = render partial: 'segments/placeholders/gallery'

- if gallery.masonry?
  :coffee
    $grid = $('##{dom_id(gallery, :content)}').find '.grid'
    reversed = $grid.closest('.segment').hasClass 'align-bottom'
    $grid.imagesLoaded ->
      $grid.masonry
        itemSelector: '.grid-item'
        columnWidth: '.grid-item'
        percentPosition: true
        horizontalOrder: true
        originTop: !reversed
