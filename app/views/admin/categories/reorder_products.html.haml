.page-header
  = link_to admin_categories_path, class: 'btn btn-default' do
    = icon('chevron-circle-left', t('actions.back'))
  %h1= icon('reorder', @category)

.table-responsive
  %table.table.table-striped.table-hover.table-loose
    %thead
      %tr
        %th.col-min.hidden-print
        %th.col-xs-2= col(Product, :code)
        %th= col(Product, :title)

    %tbody{class: current_user.can_update?(Category) ? 'sortable' : nil}
      = content_tag_for :tr, @products do |product|
        %td.hidden-print= drag_handle
        %td= product.code
        %td
          %strong= product.title
          = product.subtitle

:coffee
  $('.sortable').sortable(
    items: 'tr'
    handle: '.handle'
    placeholder: '#{tr_placeholder(3)}'
  ).bind 'sortupdate', (e, ui) ->
    $.post '#{reorder_admin_products_path}',
      {reorder: $('tr', this).map(-> this.id).get()}
