/*!
 * froala_editor v1.2.8 (https://www.froala.com/wysiwyg-editor)
 * License https://www.froala.com/wysiwyg-editor/terms
 * Copyright 2014-2015 Froala Labs
 */
!function(e){e.Editable.commands=e.extend(e.Editable.commands,{table:{title:"Table",icon:"fa fa-table",callback:function(e,t,i){this.table_commands[t]?this.table_commands[t].apply(this,[t,i]):this.table_commands.insertTable.apply(this,[t,i]),this.cleanupTables()}}}),e.Editable.DEFAULTS.buttons[e.Editable.DEFAULTS.buttons.indexOf("insertHorizontalRule")]="table",e.Editable.prototype.table_commands={insertTable:function(e,t){this.insertTable(e,t)},insertRowAbove:function(){this.insertRow("above")},insertRowBelow:function(){this.insertRow("below")},insertColumnBefore:function(){this.insertColumn("before")},insertColumnAfter:function(){this.insertColumn("after")},deleteColumn:function(){this.deleteColumn()},deleteRow:function(){this.deleteRow()},insertCellBefore:function(){this.insertCell("before")},insertCellAfter:function(){this.insertCell("after")},mergeCells:function(){this.mergeCells()},deleteCell:function(){this.deleteCell()},splitVertical:function(){this.splitVertical()},splitHorizontal:function(){this.splitHorizontal()},insertHeader:function(){this.insertHeader()},deleteHeader:function(){this.deleteHeader()},deleteTable:function(){this.deleteTable()}},e.Editable.prototype.command_dispatcher=e.extend(e.Editable.prototype.command_dispatcher,{table:function(e){var t=this.buildDropdownTable(),i=this.buildDropdownButton(e,t,"fr-table");return this.bindTableDropdownEvents(),i}}),e.Editable.prototype.tableTab=function(){var t;this.currentCell&&(t=this.currentCell());var i=e(this.getSelectionElement());return i.parents("ul, ol").length>0?!0:t&&this.nextCell()?(this.setSelection(this.nextCell()),!1):void 0},e.Editable.prototype.tableShiftTab=function(){var t;this.currentCell&&(t=this.currentCell());var i=e(this.getSelectionElement());return i.parents("ul, ol").length>0?!0:t&&this.prevCell()?(this.setSelection(this.prevCell()),!1):void 0},e.Editable.prototype.initTable=function(){var t=this;this.$editor.on("click mouseup touch touchend",".fr-table a",function(i){i.preventDefault(),i.stopPropagation(),t.android()&&(e(this).parent().siblings().removeClass("hover"),e(this).parent().addClass("hover"))}),this.addListener("tab",this.tableTab),this.addListener("shift+tab",this.tableShiftTab)},e.Editable.initializers.push(e.Editable.prototype.initTable),e.Editable.prototype.buildDropdownTable=function(){var e='<ul class="fr-dropdown-menu fr-table">';e+='<li> <a href="#"><span data-text="true">Insert table</span> <i class="fa fa-chevron-right"></i></a><div class="select-table"> ',e+='<div class="fr-t-info">1 x 1</div>';for(var t=1;10>=t;t++){for(var i=1;10>=i;i++){var n="inline-block";(t>5||i>5)&&(n="none");var o="fr-bttn ";1==t&&1==i&&(o+=" hover"),e+='<span class="'+o+'" data-cmd="table" data-val="'+t+'" data-param="'+i+'" style="display: '+n+';"><span></span></span>'}e+='<div class="new-line"></div>'}return e+="</div> </li>",e+='<li><a href="#"><span data-text="true">Cell</span> <i class="fa fa-chevron-right"></i></a> <ul> <li data-cmd="table" data-val="insertCellBefore"><a href="#" data-text="true">Insert cell before</a></li><li data-cmd="table" data-val="insertCellAfter"><a href="#" data-text="true">Insert cell after</a></li><li data-cmd="table" data-val="deleteCell"><a href="#" data-text="true">Delete cell</a></li><li data-cmd="table" data-val="mergeCells"><a href="#" data-text="true">Merge cells</a></li><li data-cmd="table" data-val="splitHorizontal"><a href="#" data-text="true">Horizontal split</a></li><li data-cmd="table" data-val="splitVertical"><a href="#" data-text="true">Vertical split</a></li></ul></li>',e+='<li><a href="#"><span data-text="true">Row</span> <i class="fa fa-chevron-right"></i></a> <ul><li data-cmd="table" data-val="insertRowAbove"><a href="#" data-text="true">Insert row above</a></li><li data-cmd="table" data-val="insertRowBelow"><a href="#" data-text="true">Insert row below</a></li><li data-cmd="table" data-val="deleteRow"><a href="#" data-text="true">Delete row</a></li></ul></li>',e+='<li><a href="#"><span data-text="true">Column</span> <i class="fa fa-chevron-right"></i></a> <ul> <li data-cmd="table" data-val="insertColumnBefore"><a href="#" data-text="true">Insert column before</a></li> <li data-cmd="table" data-val="insertColumnAfter"><a href="#" data-text="true">Insert column after</a></li> <li data-cmd="table" data-val="deleteColumn"><a href="#" data-text="true">Delete column</a></li> </ul></li>',e+='<li data-cmd="table" data-val="deleteTable"><a href="#" data-text="true">Delete table</a></li>',e+="</ul>"},e.Editable.prototype.bindTableDropdownEvents=function(){var t=this;this.$bttn_wrapper.on("mouseenter",".fr-table .select-table > span",function(){var i=e(this).data("val"),n=e(this).data("param");t.$bttn_wrapper.find(".fr-table .select-table .fr-t-info").text(i+" x "+n),t.$bttn_wrapper.find(".fr-table .select-table > span").removeClass("hover");for(var o=1;10>=o;o++)for(var a=0;10>=a;a++){var r=t.$bttn_wrapper.find('.fr-table .select-table > span[data-val="'+o+'"][data-param="'+a+'"]');i>=o&&n>=a?r.addClass("hover"):(i+1>=o||5>=o)&&(n+1>=a||5>=a)?r.css("display","inline-block"):(o>5||a>5)&&r.css("display","none")}}),this.$bttn_wrapper.on("mouseleave",".fr-table .select-table",function(){t.$bttn_wrapper.find('.fr-table .select-table > span[data-val="1"][data-param="1"]').trigger("mouseenter")}),this.android()&&this.$bttn_wrapper.on("touchend",".fr-table .fr-trigger",function(){e(this).parents(".fr-table").find(".hover").removeClass("hover")})},e.Editable.prototype.tableMap=function(){var t=this.currentTable(),i=[];return t&&t.find("tr:not(:empty)").each(function(t,n){var o=e(n),a=0;o.find("th, td").each(function(n,o){for(var r=e(o),s=parseInt(r.attr("colspan"),10)||1,l=parseInt(r.attr("rowspan"),10)||1,d=t;t+l>d;d++)for(var h=a;a+s>h;h++)i[d]||(i[d]=[]),i[d][h]?a++:i[d][h]=o;a+=s})}),i},e.Editable.prototype.cellOrigin=function(e,t){for(var i=0;i<t.length;i++)for(var n=0;n<t[i].length;n++)if(t[i][n]==e)return{row:i,col:n}},e.Editable.prototype.canMergeCells=function(){var t=this.getSelectionCells();if(t.length<2)return!1;for(var i=this.tableMap(),n=0,o=32e3,a=0,r=32e3,s=0,l=0;l<t.length;l++){var d=e(t[l]),h=parseInt(d.attr("colspan"),10)||1,p=parseInt(d.attr("rowspan"),10)||1,c=this.cellOrigin(t[l],i);n+=h*p,o=Math.min(o,c.col),a=Math.max(a,c.col+h),r=Math.min(r,c.row),s=Math.max(s,c.row+p)}return n==(a-o)*(s-r)?{row:r,col:o,colspan:a-o,rowspan:s-r,map:i,cells:t}:null},e.Editable.prototype.getSelectionCells=function(){var t,i=[];if(this.browser.webkit||this.browser.msie){var n=this.getSelectionElements();for(t=0;t<n.length;t++)("TD"==n[t].tagName||"TH"==n[t].tagName)&&i.push(n[t])}else{var o=this.getRanges();for(t=0;t<o.length;t++){var a=o[t],r=!1;if("TD"==a.startContainer.tagName||"TH"==a.startContainer.tagName)i.push(a.startContainer),r=!0;else{var s=a.startContainer.childNodes,l=a.startOffset;if(s.length>l&&l>=0){var d=s[l];("TD"==d.tagName||"TH"==d.tagName)&&(i.push(d),r=!0)}}if(r===!1){var h=e(a.startContainer).parents("td:first, th:first");h.length>0&&i.push(h.get(0))}}}return i},e.Editable.prototype.currentCell=function(){var e=this.getSelectionCells();return e.length>0?e[0]:null},e.Editable.prototype.prevCell=function(){var t=this.currentCell();if(t){if(e(t).prev("td").length)return e(t).prev("td").get(0);if(e(t).parent().prev("tr").find("td").length)return e(t).parent().prev("tr").find("td:last").get(0)}return null},e.Editable.prototype.nextCell=function(){var t=this.currentCell();if(t){if(e(t).next("td").length)return e(t).next("td").get(0);if(e(t).parent().next("tr").find("td").length)return e(t).parent().next("tr").find("td").get(0)}return null},e.Editable.prototype.currentTable=function(){for(var t=e(this.getSelectionElement());t.get(0)!=this.$element.get(0)&&t.get(0)!=this.$document.find("body").get(0)&&"TABLE"!=t.get(0).tagName;)t=t.parent();return t.get(0)!=this.$element.get(0)?t:null},e.Editable.prototype.focusOnTable=function(){var e=this.currentTable();if(e){var t=e.find("td:first");this.setSelection(t.get(0))}},e.Editable.prototype.insertCell=function(t){for(var i=this.getSelectionCells(),n=0;n<i.length;n++){var o=e(i[n]);"before"==t?o.before(o.clone().removeAttr("colspan").removeAttr("rowspan").html(e.Editable.INVISIBLE_SPACE)):"after"==t&&o.after(o.clone().removeAttr("colspan").removeAttr("rowspan").html(e.Editable.INVISIBLE_SPACE))}"before"==t?this.triggerEvent("cellInsertedBefore"):"after"==t&&this.triggerEvent("cellInsertedAfter")},e.Editable.prototype.mergeCells=function(){var t=this.canMergeCells();if(t){var i=e(t.map[t.row][t.col]);i.attr("colspan",t.colspan),i.attr("rowspan",t.rowspan);for(var n=0;n<t.cells.length;n++){var o=t.cells[n];if(i.get(0)!=o){var a=e(o);i.append(a.html()),a.remove()}}this.setSelection(i.get(0))}this.hide(),this.triggerEvent("cellsMerged")},e.Editable.prototype.deleteCell=function(){for(var t=this.getSelectionCells(),i=0;i<t.length;i++){var n=e(t[i]);n.remove()}this.focusOnTable(),this.hide(),this.triggerEvent("cellDeleted")},e.Editable.prototype.insertHeader=function(){var e=this.currentTable();e&&e.find(" > thead").length>0&&this.triggerEvent("headerInserted")},e.Editable.prototype.deleteHeader=function(){},e.Editable.prototype.insertColumn=function(t){var i=this.currentCell();if(i)for(var n=e(i),o=this.tableMap(),a=this.cellOrigin(n.get(0),o),r=0;r<o.length;r++){var s=o[r][a.col],l=parseInt(e(s).attr("colspan"),10)||1,d=parseInt(e(s).attr("rowspan"),10)||1;if("before"==t){var h=o[r][a.col-1];h?h==s?e(h).attr("colspan",l+1):d>1?e(h).after("<"+h.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+h.tagName+">"):e(s).before("<"+s.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+s.tagName+">"):e(s).before("<"+s.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+s.tagName+">")}else if("after"==t){var p=o[r][a.col+1];p?p==s?e(p).attr("colspan",l+1):d>1?e(p).before("<"+p.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+p.tagName+">"):e(s).after("<"+s.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+s.tagName+">"):e(s).after("<"+s.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+s.tagName+">")}}this.hide(),"before"==t?this.triggerEvent("columnInsertedBefore"):"after"==t&&this.triggerEvent("columnInsertedAfter")},e.Editable.prototype.deleteColumn=function(){for(var t=this.getSelectionCells(),i=0;i<t.length;i++)for(var n=e(t[i]),o=this.tableMap(),a=this.cellOrigin(n.get(0),o),r=0;r<o.length;r++){var s=o[r][a.col],l=parseInt(e(s).attr("colspan"),10)||1;1==l?e(s).remove():e(s).attr("colspan",l-1)}this.focusOnTable(),this.hide(),this.triggerEvent("columnDeleted")},e.Editable.prototype.insertRow=function(t){var i,n=this.currentCell();if(n){var o=e(n),a=this.tableMap(),r=this.cellOrigin(o.get(0),a),s=0,l=null;for(i=0;i<a[r.row].length;i++){var d=a[r.row][i],h=parseInt(e(d).attr("rowspan"),10)||1;if("above"==t)if(0===r.row)s++;else{var p=a[r.row-1][i];p==d&&l!=d?e(d).attr("rowspan",h+1):s++}else if("below"==t)if(r.row==a.length-1)s++;else{var c=a[r.row+1][i];c==d&&l!=d?e(d).attr("rowspan",h+1):s++}l=a[r.row][i]}var u="<tr>";for(i=0;s>i;i++)u+="<td>"+e.Editable.INVISIBLE_SPACE+"</td>";u+="</tr>","below"==t?o.closest("tr").after(u):"above"==t&&o.closest("tr").before(u)}this.hide(),"below"==t?this.triggerEvent("rowInsertedBelow"):"above"==t&&this.triggerEvent("rowInsertedAbove")},e.Editable.prototype.deleteRow=function(){for(var t=this.getSelectionCells(),i=0;i<t.length;i++){var n=e(t[i]),o=this.tableMap(),a=this.cellOrigin(n.get(0),o),r=n.parents("tr:first");if(a)for(var s=0;s<o[a.row].length;s++){var l=o[a.row][s],d=parseInt(e(l).attr("rowspan"),10)||1;if(1==d)e(l).remove();else{var h=this.cellOrigin(l,o);if(e(l).attr("rowspan",d-1),h.row==a.row){var p=o[a.row+1];p&&p[s-1]&&(e(p[s-1]).after(e(l).clone()),e(l).remove())}}}r.remove()}this.focusOnTable(),this.hide(),this.triggerEvent("rowDeleted")},e.Editable.prototype.splitVertical=function(){for(var t=this.getSelectionCells(),i=0;i<t.length;i++){var n=e(t[i]),o=this.tableMap(),a=this.cellOrigin(n.get(0),o),r=parseInt(n.attr("colspan"),10)||1,s=parseInt(n.attr("rowspan"),10)||1;if(s>1){var l=Math.floor(s/2),d=a.row+(s-l),h=o[d][a.col-1];h||(h=o[d][a.col+r]),h?e(h).before(n.clone().attr("rowspan",l).html(e.Editable.INVISIBLE_SPACE)):n.parents("tr:first").after(e("<tr>").append(n.clone().attr("rowspan",l).html(e.Editable.INVISIBLE_SPACE))),n.attr("rowspan",s-l)}else{for(var p=e("<tr>").append(n.clone().html(e.Editable.INVISIBLE_SPACE)),c=null,u=0;u<o[a.row].length;u++){var f=o[a.row][u],m=parseInt(e(f).attr("rowspan"),10)||1;c!=f&&f!=n.get(0)&&e(f).attr("rowspan",m+1),c=f}n.parents("tr:first").after(p)}}this.hide(),this.triggerEvent("cellVerticalSplit")},e.Editable.prototype.splitHorizontal=function(){for(var t=this.getSelectionCells(),i=0;i<t.length;i++){var n=e(t[i]),o=this.tableMap(),a=this.cellOrigin(n.get(0),o),r=parseInt(n.attr("colspan"),10)||1;if(r>1){var s=Math.floor(r/2);n.after(n.clone().attr("colspan",s).html(e.Editable.INVISIBLE_SPACE)),n.attr("colspan",r-s)}else{for(var l=null,d=0;d<o.length;d++){var h=o[d][a.col],p=parseInt(e(h).attr("colspan"),10)||1;l!=h&&h!=n.get(0)&&e(h).attr("colspan",p+1),l=h}n.after(n.clone().html(e.Editable.INVISIBLE_SPACE))}}this.hide(),this.triggerEvent("cellHorizontalSplit")},e.Editable.prototype.insertTable=function(t,i){for(var n='<table data-last-table="true" width="100%">',o=0;t>o;o++){n+="<tr>";for(var a=0;i>a;a++)n+="<td>"+e.Editable.INVISIBLE_SPACE+"</td>";n+="</tr>"}n+="</table>",this.focus();var r=this.getSelectionElement();this.breakHTML(n,this.parents(e(r),"li").length<0);var s=this.$element.find('table[data-last-table="true"]');s.removeAttr("data-last-table"),this.setSelection(s.find("td:first").get(0)),this.hide(),this.triggerEvent("tableInserted")},e.Editable.prototype.deleteTable=function(){var e=this.currentTable();e&&(e.remove(),this.focus(),this.hide(),this.triggerEvent("tableDeleted"))},e.Editable.prototype.cleanupTables=function(){this.$element.find('td[colspan="1"], th[colspan="1"]').each(function(){e(this).removeAttr("colspan")}),this.$element.find('td[rowspan="1"], th[rowspan="1"]').each(function(){e(this).removeAttr("rowspan")})}}(jQuery);