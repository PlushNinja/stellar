- cache_if current_user.guest?, [I18n.locale, :product_detail, product] do
  .product-header
    .actions
      - if current_user.can_update?(product)
        = link_to icon('edit', t('actions.edit')), edit_admin_product_path(product), class: 'btn btn-default'
      = link_to icon('times'), '#back', class: 'btn btn-default'
    %h1.product-title
      = product.title
      %span.small= product.subtitle

  .product-body
    .images.presentational
      = render partial: 'products/images', locals: {product: product, purpose: :presentational}

    .product-meta
      %p.product-code
        - if product.customer_code.present?
          = icon('barcode', product.customer_code, class: 'fa-lg')
        = icon('barcode', product.code, class: 'fa-lg fa-flip-horizontal')

      - if can_see_pricing? && can_shop? && may_shop_at?(@category)
        .buy-now
          .product-pricing
            = render partial: 'products/pricing', object: product, as: :product
          = render partial: 'products/buy_now', object: product, as: :product

      - if product.variant?
        .variant-products
          = render partial: 'products/variants_dropdown', object: product, as: :product

      - if can_see_stock?
        .product-stock
          = product_stock_string(product.stock)

    .product-description
      .body-text><= product.description.html_safe if product.description.present?

      - if product.images.document.any?
        .documents.list-group
          - product.images.document.each do |document|
            = link_to(icon('paperclip', document.to_s),
                document.url(:original), class: 'list-group-item')

    .product-properties
      = render partial: 'products/properties_components_table', object: product, as: :product

    .images.technical
      = render partial: 'products/images', locals: {product: product, purpose: :technical}

    - if product.iframes.any?
      .iframes
        = render partial: 'iframes/gallery', object: product, as: :product, locals: {inline: current_store.inline_iframes}

  .product-footer

    - if product.variant?
      %h2= t('store.product_variants')
      .variant-products
        %ul= render partial: 'products/variant_product', collection: product.sibling_variants.live.sorted, as: :product, locals: {context: product}

    - if product.requisite_products.live.any?
      %h2= t('store.requisite_products')
      .requisite-products
        %ul= render partial: 'products/requisite_product', collection: product.requisite_products.live, as: :product
      = render partial: 'store/select_for_cart_modal', object: product, as: :product
