/*!
 * froala_editor v1.2.8 (https://www.froala.com/wysiwyg-editor)
 * License https://www.froala.com/wysiwyg-editor/terms
 * Copyright 2014-2015 Froala Labs
 */
!function(e){e.Editable.commands=e.extend(e.Editable.commands,{uploadFile:{title:"Upload File",icon:"fa fa-paperclip",callback:function(){this.insertFile()},undo:!1}}),e.Editable.DEFAULTS=e.extend(e.Editable.DEFAULTS,{allowedFileTypes:["*"],fileDeleteUrl:null,fileDeleteParams:{},fileUploadParams:{},fileUploadURL:"http://i.froala.com/upload",fileUploadParam:"file",maxFileSize:10485760,useFileName:!0}),e.Editable.prototype.showFileWrapper=function(){this.$file_wrapper&&this.$file_wrapper.show()},e.Editable.prototype.hideFileWrapper=function(){this.$file_wrapper&&(this.$file_wrapper.hide(),this.$file_wrapper.find("input").blur())},e.Editable.prototype.showFileUpload=function(){this.hidePopups(),this.showFileWrapper()},e.Editable.prototype.insertFile=function(){this.closeImageMode(),this.imageMode=!1,this.showFileUpload(),this.saveSelectionByMarkers(),this.options.inlineMode||this.positionPopup("uploadFile")},e.Editable.prototype.fileUploadHTML=function(){var t='<div class="froala-popup froala-file-popup" style="display: none;"><h4><span data-text="true">Upload file</span><i title="Cancel" class="fa fa-times" id="f-file-close-'+this._id+'"></i></h4>';return t+='<div id="f-file-list-'+this._id+'">',t+='<div class="f-popup-line drop-upload">',t+='<div class="f-upload" id="f-file-upload-div-'+this._id+'"><strong data-text="true">Drop File</strong><br>(<span data-text="true">or click</span>)<form target="file-frame-'+this._id+'" enctype="multipart/form-data" encoding="multipart/form-data" action="'+this.options.fileUploadURL+'" method="post" id="f-file-form-'+this._id+'"><input id="f-file-upload-'+this._id+'" type="file" name="'+this.options.fileUploadParam+'" accept="/*"></form></div>',this.browser.msie&&e.Editable.getIEversion()<=9&&(t+='<iframe id="file-frame-'+this._id+'" name="file-frame-'+this._id+'" src="javascript:false;" style="width:0; height:0; border:0px solid #FFF; position: fixed; z-index: -1;" data-loaded="true"></iframe>'),t+="</div>",t+="</div>",t+='<p class="f-progress" id="f-file-progress-'+this._id+'"><span></span></p>',t+="</div>"},e.Editable.prototype.buildFileDrag=function(){var t=this;t.$file_wrapper.on("dragover","#f-file-upload-div-"+this._id,function(){return e(this).addClass("f-hover"),!1}),t.$file_wrapper.on("dragend","#f-file-upload-div-"+this._id,function(){return e(this).removeClass("f-hover"),!1}),t.$file_wrapper.on("drop","#f-file-upload-div-"+this._id,function(i){i.preventDefault(),i.stopPropagation(),e(this).removeClass("f-hover"),t.uploadFile(i.originalEvent.dataTransfer.files)}),t.$element.on("drop",function(i){var n=i.originalEvent.dataTransfer.files;if(0===e(".froala-element img.fr-image-move").length&&i.originalEvent.dataTransfer&&n&&n.length){if(t.isDisabled)return!1;t.options.allowedImageTypes.indexOf(n[0].type.replace(/image\//g,""))<0&&(t.closeImageMode(),t.hide(),t.imageMode=!1,t.initialized||(t.$element.unbind("mousedown.element"),t.lateInit()),t.insertMarkersAtPoint(i.originalEvent),t.showByCoordinates(i.originalEvent.pageX,i.originalEvent.pageY),t.uploadFile(n),i.preventDefault(),i.stopPropagation())}})},e.Editable.prototype.buildFileUpload=function(){this.$file_wrapper=e(this.fileUploadHTML()),this.$popup_editor.append(this.$file_wrapper),this.buildFileDrag();var t=this;if(this.$file_wrapper.on("mouseup touchend",e.proxy(function(e){this.isResizing()||e.stopPropagation()},this)),this.addListener("hidePopups",e.proxy(function(){this.hideFileWrapper()},this)),this.$file_progress_bar=this.$file_wrapper.find("p#f-file-progress-"+this._id),this.browser.msie&&e.Editable.getIEversion()<=9){var i=this.$file_wrapper.find("iframe").get(0);i.attachEvent?i.attachEvent("onload",function(){t.iFrameLoad()}):i.onload=function(){t.iFrameLoad()}}this.$file_wrapper.on("change",'input[type="file"]',function(){if(void 0!==this.files)t.uploadFile(this.files);else{var i=e(this).parents("form");i.find('input[type="hidden"]').remove();var n;for(n in t.options.fileUploadParams)i.prepend('<input type="hidden" name="'+n+'" value="'+t.options.fileUploadParams[n]+'" />');t.$file_wrapper.find("#f-file-list-"+t._id).hide(),t.$file_progress_bar.show(),t.$file_progress_bar.find("span").css("width","100%").text("Please wait!"),t.showFileUpload(),i.submit()}e(this).val("")}),this.$file_wrapper.on(this.mouseup,"#f-file-close-"+this._id,e.proxy(function(e){e.stopPropagation(),e.preventDefault(),this.$bttn_wrapper.show(),this.hideFileWrapper(),this.restoreSelection(),this.focus(),this.hide()},this)),this.$file_wrapper.on("click",function(e){e.stopPropagation()}),this.$file_wrapper.on("click","*",function(e){e.stopPropagation()})},e.Editable.initializers.push(e.Editable.prototype.buildFileUpload),e.Editable.prototype.uploadFile=function(t){if(!this.triggerEvent("beforeFileUpload",[t],!1))return!1;if(void 0!==t&&t.length>0){var i;if(this.drag_support.formdata&&(i=this.drag_support.formdata?new FormData:null),i){var n;for(n in this.options.fileUploadParams)i.append(n,this.options.fileUploadParams[n]);if(i.append(this.options.fileUploadParam,t[0]),t[0].size>this.options.maxFileSize)return this.throwFileError(5),!1;if(this.options.allowedFileTypes.indexOf(t[0].type)<0&&this.options.allowedFileTypes.indexOf("*")<0)return this.throwFileError(6),!1}if(i){var o;if(this.options.crossDomain)o=this.createCORSRequest("POST",this.options.fileUploadURL);else{o=new XMLHttpRequest,o.open("POST",this.options.fileUploadURL);for(var a in this.options.headers)o.setRequestHeader(a,this.options.headers[a])}var r=t[0].name;o.onload=e.proxy(function(){this.$file_progress_bar.find("span").css("width","100%").text("Please wait!");try{o.status>=200&&o.status<300?this.parseFileResponse(o.responseText,r):this.throwFileError(3)}catch(e){this.throwFileError(4)}},this),o.onerror=e.proxy(function(){this.throwFileError(3)},this),o.upload.onprogress=e.proxy(function(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;this.$file_progress_bar.find("span").css("width",t+"%")}},this),o.send(i),this.$file_wrapper.find("#f-file-list-"+this._id).hide(),this.$file_progress_bar.show(),this.showFileUpload()}}},e.Editable.prototype.throwFileError=function(e){var t="Unknown file upload error.";1==e?t="Bad link.":2==e?t="No link in upload response.":3==e?t="Error during file upload.":4==e?t="Parsing response failed.":5==e?t="File too large.":6==e?t="Invalid file type.":7==e&&(t="File can be uploaded only to same domain in IE 8 and IE 9."),this.triggerEvent("fileError",[{code:e,message:t}],!1),this.hideFileLoader()},e.Editable.prototype.hideFileLoader=function(){this.$file_progress_bar.hide(),this.$file_progress_bar.find("span").css("width","0%").text(""),this.$file_wrapper.find("#f-file-list-"+this._id).show()},e.Editable.prototype.throwFileErrorWithMessage=function(e){this.triggerEvent("fileError",[{message:e,code:0}],!1),this.hideFileLoader()},e.Editable.prototype.parseFileResponse=function(t,i){try{if(!this.triggerEvent("afterFileUpload",[t],!1))return!1;var n=e.parseJSON(t);n.link?this.writeFile(n.link,i,t):n.error?this.throwFileErrorWithMessage(n.error):this.throwFileError(2)}catch(o){this.throwFileError(4)}},e.Editable.prototype.writeFile=function(e,t,i){this.restoreSelectionByMarkers(),this.focus(),this.options.useFileName||""===this.text()||(t=this.text()),this.insertHTML('<a class="fr-file" href="'+this.sanitizeURL(e)+'">'+t+"</a>"),this.hide(),this.hideFileLoader(),this.focus(),this.triggerEvent("fileUploaded",[t,e,i])}}(jQuery);