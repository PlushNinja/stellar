/*!
 * froala_editor v1.2.8 (https://www.froala.com/wysiwyg-editor)
 * License https://www.froala.com/wysiwyg-editor/terms
 * Copyright 2014-2015 Froala Labs
 */
!function(e){e.Editable.commands=e.extend(e.Editable.commands,{table:{title:"Table",icon:"fa fa-table",callback:function(e,t,a){this.table_commands[t]?this.table_commands[t].apply(this,[t,a]):this.table_commands.insertTable.apply(this,[t,a]),this.cleanupTables()}}}),e.Editable.DEFAULTS.buttons[e.Editable.DEFAULTS.buttons.indexOf("insertHorizontalRule")]="table",e.Editable.prototype.table_commands={insertTable:function(e,t){this.insertTable(e,t)},insertRowAbove:function(){this.insertRow("above")},insertRowBelow:function(){this.insertRow("below")},insertColumnBefore:function(){this.insertColumn("before")},insertColumnAfter:function(){this.insertColumn("after")},deleteColumn:function(){this.deleteColumn()},deleteRow:function(){this.deleteRow()},insertCellBefore:function(){this.insertCell("before")},insertCellAfter:function(){this.insertCell("after")},mergeCells:function(){this.mergeCells()},deleteCell:function(){this.deleteCell()},splitVertical:function(){this.splitVertical()},splitHorizontal:function(){this.splitHorizontal()},insertHeader:function(){this.insertHeader()},deleteHeader:function(){this.deleteHeader()},deleteTable:function(){this.deleteTable()}},e.Editable.prototype.command_dispatcher=e.extend(e.Editable.prototype.command_dispatcher,{table:function(e){var t=this.buildDropdownTable(),a=this.buildDropdownButton(e,t,"fr-table");return this.bindTableDropdownEvents(),a}}),e.Editable.prototype.tableTab=function(){var t;this.currentCell&&(t=this.currentCell());var a=e(this.getSelectionElement());return a.parents("ul, ol").length>0?!0:t&&this.nextCell()?(this.setSelection(this.nextCell()),!1):void 0},e.Editable.prototype.tableShiftTab=function(){var t;this.currentCell&&(t=this.currentCell());var a=e(this.getSelectionElement());return a.parents("ul, ol").length>0?!0:t&&this.prevCell()?(this.setSelection(this.prevCell()),!1):void 0},e.Editable.prototype.initTable=function(){var t=this;this.$editor.on("click mouseup touch touchend",".fr-table a",function(a){a.preventDefault(),a.stopPropagation(),t.android()&&(e(this).parent().siblings().removeClass("hover"),e(this).parent().addClass("hover"))}),this.addListener("tab",this.tableTab),this.addListener("shift+tab",this.tableShiftTab)},e.Editable.initializers.push(e.Editable.prototype.initTable),e.Editable.prototype.buildDropdownTable=function(){var e='<ul class="fr-dropdown-menu fr-table">';e+='<li> <a href="#"><span data-text="true">Insert table</span> <i class="fa fa-chevron-right"></i></a><div class="select-table"> ',e+='<div class="fr-t-info">1 x 1</div>';for(var t=1;10>=t;t++){for(var a=1;10>=a;a++){var i="inline-block";(t>5||a>5)&&(i="none");var l="fr-bttn ";1==t&&1==a&&(l+=" hover"),e+='<span class="'+l+'" data-cmd="table" data-val="'+t+'" data-param="'+a+'" style="display: '+i+';"><span></span></span>'}e+='<div class="new-line"></div>'}return e+="</div> </li>",e+='<li><a href="#"><span data-text="true">Cell</span> <i class="fa fa-chevron-right"></i></a> <ul> <li data-cmd="table" data-val="insertCellBefore"><a href="#" data-text="true">Insert cell before</a></li><li data-cmd="table" data-val="insertCellAfter"><a href="#" data-text="true">Insert cell after</a></li><li data-cmd="table" data-val="deleteCell"><a href="#" data-text="true">Delete cell</a></li><li data-cmd="table" data-val="mergeCells"><a href="#" data-text="true">Merge cells</a></li><li data-cmd="table" data-val="splitHorizontal"><a href="#" data-text="true">Horizontal split</a></li><li data-cmd="table" data-val="splitVertical"><a href="#" data-text="true">Vertical split</a></li></ul></li>',e+='<li><a href="#"><span data-text="true">Row</span> <i class="fa fa-chevron-right"></i></a> <ul><li data-cmd="table" data-val="insertRowAbove"><a href="#" data-text="true">Insert row above</a></li><li data-cmd="table" data-val="insertRowBelow"><a href="#" data-text="true">Insert row below</a></li><li data-cmd="table" data-val="deleteRow"><a href="#" data-text="true">Delete row</a></li></ul></li>',e+='<li><a href="#"><span data-text="true">Column</span> <i class="fa fa-chevron-right"></i></a> <ul> <li data-cmd="table" data-val="insertColumnBefore"><a href="#" data-text="true">Insert column before</a></li> <li data-cmd="table" data-val="insertColumnAfter"><a href="#" data-text="true">Insert column after</a></li> <li data-cmd="table" data-val="deleteColumn"><a href="#" data-text="true">Delete column</a></li> </ul></li>',e+='<li data-cmd="table" data-val="deleteTable"><a href="#" data-text="true">Delete table</a></li>',e+="</ul>"},e.Editable.prototype.bindTableDropdownEvents=function(){var t=this;this.$bttn_wrapper.on("mouseenter",".fr-table .select-table > span",function(){var a=e(this).data("val"),i=e(this).data("param");t.$bttn_wrapper.find(".fr-table .select-table .fr-t-info").text(a+" x "+i),t.$bttn_wrapper.find(".fr-table .select-table > span").removeClass("hover");for(var l=1;10>=l;l++)for(var r=0;10>=r;r++){var n=t.$bttn_wrapper.find('.fr-table .select-table > span[data-val="'+l+'"][data-param="'+r+'"]');a>=l&&i>=r?n.addClass("hover"):(a+1>=l||5>=l)&&(i+1>=r||5>=r)?n.css("display","inline-block"):(l>5||r>5)&&n.css("display","none")}}),this.$bttn_wrapper.on("mouseleave",".fr-table .select-table",function(){t.$bttn_wrapper.find('.fr-table .select-table > span[data-val="1"][data-param="1"]').trigger("mouseenter")}),this.android()&&this.$bttn_wrapper.on("touchend",".fr-table .fr-trigger",function(){e(this).parents(".fr-table").find(".hover").removeClass("hover")})},e.Editable.prototype.tableMap=function(){var t=this.currentTable(),a=[];return t&&t.find("tr:not(:empty)").each(function(t,i){var l=e(i),r=0;l.find("th, td").each(function(i,l){for(var n=e(l),o=parseInt(n.attr("colspan"),10)||1,s=parseInt(n.attr("rowspan"),10)||1,d=t;t+s>d;d++)for(var c=r;r+o>c;c++)a[d]||(a[d]=[]),a[d][c]?r++:a[d][c]=l;r+=o})}),a},e.Editable.prototype.cellOrigin=function(e,t){for(var a=0;a<t.length;a++)for(var i=0;i<t[a].length;i++)if(t[a][i]==e)return{row:a,col:i}},e.Editable.prototype.canMergeCells=function(){var t=this.getSelectionCells();if(t.length<2)return!1;for(var a=this.tableMap(),i=0,l=32e3,r=0,n=32e3,o=0,s=0;s<t.length;s++){var d=e(t[s]),c=parseInt(d.attr("colspan"),10)||1,g=parseInt(d.attr("rowspan"),10)||1,p=this.cellOrigin(t[s],a);i+=c*g,l=Math.min(l,p.col),r=Math.max(r,p.col+c),n=Math.min(n,p.row),o=Math.max(o,p.row+g)}return i==(r-l)*(o-n)?{row:n,col:l,colspan:r-l,rowspan:o-n,map:a,cells:t}:null},e.Editable.prototype.getSelectionCells=function(){var t,a=[];if(this.browser.webkit||this.browser.msie){var i=this.getSelectionElements();for(t=0;t<i.length;t++)("TD"==i[t].tagName||"TH"==i[t].tagName)&&a.push(i[t])}else{var l=this.getRanges();for(t=0;t<l.length;t++){var r=l[t],n=!1;if("TD"==r.startContainer.tagName||"TH"==r.startContainer.tagName)a.push(r.startContainer),n=!0;else{var o=r.startContainer.childNodes,s=r.startOffset;if(o.length>s&&s>=0){var d=o[s];("TD"==d.tagName||"TH"==d.tagName)&&(a.push(d),n=!0)}}if(n===!1){var c=e(r.startContainer).parents("td:first, th:first");c.length>0&&a.push(c.get(0))}}}return a},e.Editable.prototype.currentCell=function(){var e=this.getSelectionCells();return e.length>0?e[0]:null},e.Editable.prototype.prevCell=function(){var t=this.currentCell();if(t){if(e(t).prev("td").length)return e(t).prev("td").get(0);if(e(t).parent().prev("tr").find("td").length)return e(t).parent().prev("tr").find("td:last").get(0)}return null},e.Editable.prototype.nextCell=function(){var t=this.currentCell();if(t){if(e(t).next("td").length)return e(t).next("td").get(0);if(e(t).parent().next("tr").find("td").length)return e(t).parent().next("tr").find("td").get(0)}return null},e.Editable.prototype.currentTable=function(){for(var t=e(this.getSelectionElement());t.get(0)!=this.$element.get(0)&&t.get(0)!=this.$document.find("body").get(0)&&"TABLE"!=t.get(0).tagName;)t=t.parent();return t.get(0)!=this.$element.get(0)?t:null},e.Editable.prototype.focusOnTable=function(){var e=this.currentTable();if(e){var t=e.find("td:first");this.setSelection(t.get(0))}},e.Editable.prototype.insertCell=function(t){for(var a=this.getSelectionCells(),i=0;i<a.length;i++){var l=e(a[i]);"before"==t?l.before(l.clone().removeAttr("colspan").removeAttr("rowspan").html(e.Editable.INVISIBLE_SPACE)):"after"==t&&l.after(l.clone().removeAttr("colspan").removeAttr("rowspan").html(e.Editable.INVISIBLE_SPACE))}"before"==t?this.triggerEvent("cellInsertedBefore"):"after"==t&&this.triggerEvent("cellInsertedAfter")},e.Editable.prototype.mergeCells=function(){var t=this.canMergeCells();if(t){var a=e(t.map[t.row][t.col]);a.attr("colspan",t.colspan),a.attr("rowspan",t.rowspan);for(var i=0;i<t.cells.length;i++){var l=t.cells[i];if(a.get(0)!=l){var r=e(l);a.append(r.html()),r.remove()}}this.setSelection(a.get(0))}this.hide(),this.triggerEvent("cellsMerged")},e.Editable.prototype.deleteCell=function(){for(var t=this.getSelectionCells(),a=0;a<t.length;a++){var i=e(t[a]);i.remove()}this.focusOnTable(),this.hide(),this.triggerEvent("cellDeleted")},e.Editable.prototype.insertHeader=function(){var e=this.currentTable();e&&e.find(" > thead").length>0&&this.triggerEvent("headerInserted")},e.Editable.prototype.deleteHeader=function(){},e.Editable.prototype.insertColumn=function(t){var a=this.currentCell();if(a)for(var i=e(a),l=this.tableMap(),r=this.cellOrigin(i.get(0),l),n=0;n<l.length;n++){var o=l[n][r.col],s=parseInt(e(o).attr("colspan"),10)||1,d=parseInt(e(o).attr("rowspan"),10)||1;if("before"==t){var c=l[n][r.col-1];c?c==o?e(c).attr("colspan",s+1):d>1?e(c).after("<"+c.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+c.tagName+">"):e(o).before("<"+o.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+o.tagName+">"):e(o).before("<"+o.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+o.tagName+">")}else if("after"==t){var g=l[n][r.col+1];g?g==o?e(g).attr("colspan",s+1):d>1?e(g).before("<"+g.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+g.tagName+">"):e(o).after("<"+o.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+o.tagName+">"):e(o).after("<"+o.tagName+">"+e.Editable.INVISIBLE_SPACE+"</"+o.tagName+">")}}this.hide(),"before"==t?this.triggerEvent("columnInsertedBefore"):"after"==t&&this.triggerEvent("columnInsertedAfter")},e.Editable.prototype.deleteColumn=function(){for(var t=this.getSelectionCells(),a=0;a<t.length;a++)for(var i=e(t[a]),l=this.tableMap(),r=this.cellOrigin(i.get(0),l),n=0;n<l.length;n++){var o=l[n][r.col],s=parseInt(e(o).attr("colspan"),10)||1;1==s?e(o).remove():e(o).attr("colspan",s-1)}this.focusOnTable(),this.hide(),this.triggerEvent("columnDeleted")},e.Editable.prototype.insertRow=function(t){var a,i=this.currentCell();if(i){var l=e(i),r=this.tableMap(),n=this.cellOrigin(l.get(0),r),o=0,s=null;for(a=0;a<r[n.row].length;a++){var d=r[n.row][a],c=parseInt(e(d).attr("rowspan"),10)||1;if("above"==t)if(0===n.row)o++;else{var g=r[n.row-1][a];g==d&&s!=d?e(d).attr("rowspan",c+1):o++}else if("below"==t)if(n.row==r.length-1)o++;else{var p=r[n.row+1][a];p==d&&s!=d?e(d).attr("rowspan",c+1):o++}s=r[n.row][a]}var m="<tr>";for(a=0;o>a;a++)m+="<td>"+e.Editable.INVISIBLE_SPACE+"</td>";m+="</tr>","below"==t?l.closest("tr").after(m):"above"==t&&l.closest("tr").before(m)}this.hide(),"below"==t?this.triggerEvent("rowInsertedBelow"):"above"==t&&this.triggerEvent("rowInsertedAbove")},e.Editable.prototype.deleteRow=function(){for(var t=this.getSelectionCells(),a=0;a<t.length;a++){var i=e(t[a]),l=this.tableMap(),r=this.cellOrigin(i.get(0),l),n=i.parents("tr:first");if(r)for(var o=0;o<l[r.row].length;o++){var s=l[r.row][o],d=parseInt(e(s).attr("rowspan"),10)||1;if(1==d)e(s).remove();else{var c=this.cellOrigin(s,l);if(e(s).attr("rowspan",d-1),c.row==r.row){var g=l[r.row+1];g&&g[o-1]&&(e(g[o-1]).after(e(s).clone()),e(s).remove())}}}n.remove()}this.focusOnTable(),this.hide(),this.triggerEvent("rowDeleted")},e.Editable.prototype.splitVertical=function(){for(var t=this.getSelectionCells(),a=0;a<t.length;a++){var i=e(t[a]),l=this.tableMap(),r=this.cellOrigin(i.get(0),l),n=parseInt(i.attr("colspan"),10)||1,o=parseInt(i.attr("rowspan"),10)||1;if(o>1){var s=Math.floor(o/2),d=r.row+(o-s),c=l[d][r.col-1];c||(c=l[d][r.col+n]),c?e(c).before(i.clone().attr("rowspan",s).html(e.Editable.INVISIBLE_SPACE)):i.parents("tr:first").after(e("<tr>").append(i.clone().attr("rowspan",s).html(e.Editable.INVISIBLE_SPACE))),i.attr("rowspan",o-s)}else{for(var g=e("<tr>").append(i.clone().html(e.Editable.INVISIBLE_SPACE)),p=null,m=0;m<l[r.row].length;m++){var u=l[r.row][m],h=parseInt(e(u).attr("rowspan"),10)||1;p!=u&&u!=i.get(0)&&e(u).attr("rowspan",h+1),p=u}i.parents("tr:first").after(g)}}this.hide(),this.triggerEvent("cellVerticalSplit")},e.Editable.prototype.splitHorizontal=function(){for(var t=this.getSelectionCells(),a=0;a<t.length;a++){var i=e(t[a]),l=this.tableMap(),r=this.cellOrigin(i.get(0),l),n=parseInt(i.attr("colspan"),10)||1;if(n>1){var o=Math.floor(n/2);i.after(i.clone().attr("colspan",o).html(e.Editable.INVISIBLE_SPACE)),i.attr("colspan",n-o)}else{for(var s=null,d=0;d<l.length;d++){var c=l[d][r.col],g=parseInt(e(c).attr("colspan"),10)||1;s!=c&&c!=i.get(0)&&e(c).attr("colspan",g+1),s=c}i.after(i.clone().html(e.Editable.INVISIBLE_SPACE))}}this.hide(),this.triggerEvent("cellHorizontalSplit")},e.Editable.prototype.insertTable=function(t,a){for(var i='<table data-last-table="true" width="100%">',l=0;t>l;l++){i+="<tr>";for(var r=0;a>r;r++)i+="<td>"+e.Editable.INVISIBLE_SPACE+"</td>";i+="</tr>"}i+="</table>",this.focus();var n=this.getSelectionElement();this.breakHTML(i,this.parents(e(n),"li").length<0);var o=this.$element.find('table[data-last-table="true"]');o.removeAttr("data-last-table"),this.setSelection(o.find("td:first").get(0)),this.hide(),this.triggerEvent("tableInserted")},e.Editable.prototype.deleteTable=function(){var e=this.currentTable();e&&(e.remove(),this.focus(),this.hide(),this.triggerEvent("tableDeleted"))},e.Editable.prototype.cleanupTables=function(){this.$element.find('td[colspan="1"], th[colspan="1"]').each(function(){e(this).removeAttr("colspan")}),this.$element.find('td[rowspan="1"], th[rowspan="1"]').each(function(){e(this).removeAttr("rowspan")})}}(jQuery);