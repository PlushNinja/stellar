<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">

<title>class ApplicationController - Rails Application Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">ActionController::Base
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-admin-3F">#admin?</a>
    
    <li class="calls-super" ><a href="#method-i-after_sign_in_path_for">#after_sign_in_path_for</a>
    
    <li ><a href="#method-i-authenticate_user_or_skip-21">#authenticate_user_or_skip!</a>
    
    <li ><a href="#method-i-authority_forbidden">#authority_forbidden</a>
    
    <li ><a href="#method-i-can_manage-3F">#can_manage?</a>
    
    <li ><a href="#method-i-can_order-3F">#can_order?</a>
    
    <li ><a href="#method-i-can_select_customer-3F">#can_select_customer?</a>
    
    <li ><a href="#method-i-current_group">#current_group</a>
    
    <li ><a href="#method-i-current_hostname">#current_hostname</a>
    
    <li ><a href="#method-i-current_site_name">#current_site_name</a>
    
    <li ><a href="#method-i-current_store">#current_store</a>
    
    <li ><a href="#method-i-current_theme">#current_theme</a>
    
    <li ><a href="#method-i-current_user_has_role-3F">#current_user_has_role?</a>
    
    <li ><a href="#method-i-default_inventory">#default_inventory</a>
    
    <li ><a href="#method-i-guest-3F">#guest?</a>
    
    <li ><a href="#method-i-guest_user">#guest_user</a>
    
    <li ><a href="#method-i-incl_tax-3F">#incl_tax?</a>
    
    <li ><a href="#method-i-may_shop_at-3F">#may_shop_at?</a>
    
    <li ><a href="#method-i-orientate">#orientate</a>
    
    <li ><a href="#method-i-policies_pending-3F">#policies_pending?</a>
    
    <li ><a href="#method-i-premium_pricing">#premium_pricing</a>
    
    <li ><a href="#method-i-pricing">#pricing</a>
    
    <li ><a href="#method-i-pricing_shown-3F">#pricing_shown?</a>
    
    <li ><a href="#method-i-saved_search_query">#saved_search_query</a>
    
    <li ><a href="#method-i-selected_customer">#selected_customer</a>
    
    <li ><a href="#method-i-selected_group">#selected_group</a>
    
    <li ><a href="#method-i-shopping_cart">#shopping_cart</a>
    
    <li ><a href="#method-i-stock_shown-3F">#stock_shown?</a>
    
    <li ><a href="#method-i-third_party-3F">#third_party?</a>
    
    <li ><a href="#method-i-track">#track</a>
    
    <li ><a href="#method-i-user_shopping_cart">#user_shopping_cart</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ApplicationController">
  <h1 id="class-ApplicationController" class="class">
    class ApplicationController
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-admin-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">admin?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="admin-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 191</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">admin?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">parent</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Admin</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-after_sign_in_path_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">after_sign_in_path_for</span><span
            class="method-args">(resource)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>After sign in, users who can manage are taken to the dashboard. Everyone
else goes to the default root path. <a href="Store.html">Store</a> admin
with pending policies are shown the policies index however.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="after_sign_in_path_for-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">after_sign_in_path_for</span>(<span class="ruby-identifier">resource</span>)
  <span class="ruby-identifier">stored_location_for</span>(<span class="ruby-identifier">resource</span>) <span class="ruby-operator">||</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">can_manage?</span>
      <span class="ruby-identifier">policies_pending?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">admin_policies_url</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">admin_dashboard_url</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">super</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-authenticate_user_or_skip-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">authenticate_user_or_skip!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Authenticate user, but skip authentication if guests are admitted.</p>
          
          

          
          <div class="method-source-code" id="authenticate_user_or_skip-21-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">authenticate_user_or_skip!</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_store</span>.<span class="ruby-identifier">admit_guests?</span>
  <span class="ruby-identifier">authenticate_user!</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-authority_forbidden" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">authority_forbidden</span><span
            class="method-args">(error)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Send the user back where she came from if not authorized.</p>
          
          

          
          <div class="method-source-code" id="authority_forbidden-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">authority_forbidden</span>(<span class="ruby-identifier">error</span>)
  <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-identifier">error</span>.<span class="ruby-identifier">message</span>)
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">referrer</span>.<span class="ruby-identifier">presence</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">root_path</span>,
    <span class="ruby-identifier">alert</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;You are not authorized to complete that action.&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-can_manage-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_manage?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="can_manage-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 176</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_manage?</span>
  <span class="ruby-ivar">@can_manage</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Role</span>.<span class="ruby-identifier">administrative</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">role</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">current_user_has_role?</span>(<span class="ruby-identifier">role</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-can_order-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_order?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="can_order-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 131</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_order?</span>
  <span class="ruby-ivar">@can_order</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">can?</span>(<span class="ruby-value">:order</span>, <span class="ruby-identifier">as</span><span class="ruby-operator">:</span> <span class="ruby-identifier">selected_group</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@can_order</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@can_order</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-can_select_customer-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_select_customer?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="can_select_customer-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 196</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_select_customer?</span>
  <span class="ruby-identifier">current_user_has_role?</span>(<span class="ruby-value">:customer_selection</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-current_group" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">current_group</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="current_group-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 93</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">current_group</span>
  <span class="ruby-ivar">@current_group</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">group</span>(<span class="ruby-identifier">current_store</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-current_hostname" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">current_hostname</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The methods below are for convenience and to cache often repeated database
queries on current user and her roles.</p>
          
          

          
          <div class="method-source-code" id="current_hostname-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">current_hostname</span>
  <span class="ruby-ivar">@current_hostname</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-current_site_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">current_site_name</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="current_site_name-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">current_site_name</span>
  <span class="ruby-identifier">current_store</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_store</span>.<span class="ruby-identifier">name</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-current_store" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">current_store</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="current_store-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 88</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">current_store</span>
  <span class="ruby-ivar">@current_store</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-current_theme" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">current_theme</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="current_theme-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 103</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">current_theme</span>
  <span class="ruby-identifier">current_store</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_store</span>.<span class="ruby-identifier">theme</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-current_user_has_role-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">current_user_has_role?</span><span
            class="method-args">(role)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Convenience method to check current user roles at current store.</p>
          
          

          
          <div class="method-source-code" id="current_user_has_role-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 120</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">current_user_has_role?</span>(<span class="ruby-identifier">role</span>)
  <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">has_cached_role?</span>(<span class="ruby-identifier">role</span>, <span class="ruby-identifier">current_store</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-default_inventory" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">default_inventory</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="default_inventory-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">default_inventory</span>
  <span class="ruby-identifier">current_store</span>.<span class="ruby-identifier">default_inventory</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-guest-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">guest?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Belonging to the default group is considered being a guest.</p>
          
          

          
          <div class="method-source-code" id="guest-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 126</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">guest?</span>
  <span class="ruby-ivar">@guest</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">current_group</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_store</span>.<span class="ruby-identifier">default_group</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-guest_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">guest_user</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Find the guest user stored in session, or create it.</p>
          
          

          
          <div class="method-source-code" id="guest_user-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">guest_user</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_store</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@cached_guest</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:guest_user_id</span>]) <span class="ruby-keyword">rescue</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:guest_user_id</span>] = <span class="ruby-identifier">create_guest_user</span>.<span class="ruby-identifier">id</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-incl_tax-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">incl_tax?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Convenience method to tell if prices in views are with or without tax.</p>
          
          

          
          <div class="method-source-code" id="incl_tax-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">incl_tax?</span>
  <span class="ruby-ivar">@tax_included</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">selected_group</span>.<span class="ruby-identifier">price_tax_included?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-may_shop_at-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">may_shop_at?</span><span
            class="method-args">(category)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The ability to shop at any given category depends on possible restricted
categories given to the current group. If any category assignments exist,
shopping is only allowed in the assigned categories.</p>
          
          

          
          <div class="method-source-code" id="may_shop_at-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 186</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">may_shop_at?</span>(<span class="ruby-identifier">category</span>)
  <span class="ruby-identifier">current_group</span>.<span class="ruby-identifier">categories</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_group</span>.<span class="ruby-identifier">categories</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">category</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-orientate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">orientate</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="orientate-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 18</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">orientate</span>
  <span class="ruby-ivar">@current_hostname</span> = <span class="ruby-constant">Hostname</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">fqdn</span><span class="ruby-operator">:</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@current_hostname</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@current_store</span> = <span class="ruby-ivar">@current_hostname</span>.<span class="ruby-identifier">store</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;DEFAULT_URL_HOST&#39;</span>]
      <span class="ruby-identifier">render</span> <span class="ruby-identifier">nothing</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">:bad_request</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@current_store</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-policies_pending-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">policies_pending?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="policies_pending-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">policies_pending?</span>
  <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">can_accept?</span>(<span class="ruby-constant">Policy</span>, <span class="ruby-identifier">at</span><span class="ruby-operator">:</span> <span class="ruby-identifier">current_store</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_store</span>.<span class="ruby-identifier">policies</span>.<span class="ruby-identifier">pending</span>.<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-premium_pricing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">premium_pricing</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Pricing for the premium group of current group, if any.</p>
          
          

          
          <div class="method-source-code" id="premium_pricing-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">premium_pricing</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">selected_group</span>.<span class="ruby-identifier">premium_group</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@premium_appraiser</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Appraiser</span><span class="ruby-operator">::</span><span class="ruby-constant">Product</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">selected_group</span>.<span class="ruby-identifier">premium_group</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-pricing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">pricing</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Pricing in views is handled by an appraiser for the selected group.</p>
          
          

          
          <div class="method-source-code" id="pricing-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 153</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pricing</span>
  <span class="ruby-ivar">@product_appraiser</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Appraiser</span><span class="ruby-operator">::</span><span class="ruby-constant">Product</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">selected_group</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-pricing_shown-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">pricing_shown?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="pricing_shown-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 142</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pricing_shown?</span>
  <span class="ruby-identifier">selected_group</span>.<span class="ruby-identifier">pricing_shown?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-saved_search_query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">saved_search_query</span><span
            class="method-args">(search_model, query_key)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Preserves search query params in a cookie, tagged by user id to prevent
params from propagating to another user if logged on from the same client.</p>
          
          

          
          <div class="method-source-code" id="saved_search_query-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 68</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">saved_search_query</span>(<span class="ruby-identifier">search_model</span>, <span class="ruby-identifier">query_key</span>)
  <span class="ruby-identifier">param</span> = <span class="ruby-node">&quot;#{search_model}_search&quot;</span>
  <span class="ruby-identifier">cookie_key</span> = <span class="ruby-node">&quot;#{query_key}_#{current_user.id}&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">param</span>]
    <span class="ruby-identifier">cookies</span>[<span class="ruby-identifier">cookie_key</span>] = {
      <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">param</span>].<span class="ruby-identifier">to_json</span>,
      <span class="ruby-identifier">expires</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>.<span class="ruby-identifier">weeks</span>.<span class="ruby-identifier">from_now</span>
    }
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-identifier">param</span>].<span class="ruby-identifier">presence</span> <span class="ruby-operator">||</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-identifier">cookie_key</span>]) <span class="ruby-operator">||</span> {}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-selected_customer" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">selected_customer</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="selected_customer-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">selected_customer</span>
  <span class="ruby-identifier">can_select_customer?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">shopping_cart</span>.<span class="ruby-identifier">customer</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_user</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-selected_group" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">selected_group</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="selected_group-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 206</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">selected_group</span>
  <span class="ruby-identifier">selected_customer</span>.<span class="ruby-identifier">group</span>(<span class="ruby-identifier">current_store</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shopping_cart" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shopping_cart</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Selected shopping cart, if any.</p>
          
          

          
          <div class="method-source-code" id="shopping_cart-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 109</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shopping_cart</span>
  <span class="ruby-ivar">@shopping_cart</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">selected_shopping_cart</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">user_shopping_cart</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-stock_shown-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">stock_shown?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="stock_shown-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 147</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">stock_shown?</span>
  <span class="ruby-identifier">selected_group</span>.<span class="ruby-identifier">stock_shown?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-third_party-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">third_party?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="third_party-3F-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 171</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">third_party?</span>
  <span class="ruby-identifier">current_user_has_role?</span>(<span class="ruby-value">:third_party</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-track" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">track</span><span
            class="method-args">(resource, context = nil, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Tracks activity for given resource in given context, with current store and
current user. Stores the action taken on given resource, storing any
changes made as differences, except changes between two blank values.
Options may be supplied to override the recorded action and/or differences.</p>
          
          

          
          <div class="method-source-code" id="track-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">track</span>(<span class="ruby-identifier">resource</span>, <span class="ruby-identifier">context</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">action</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:action</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">action_name</span>
  <span class="ruby-identifier">differences</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:differences</span>].<span class="ruby-identifier">presence</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">resource</span>.<span class="ruby-identifier">previous_changes</span>
    .<span class="ruby-identifier">except</span>(<span class="ruby-string">&#39;encrypted_password&#39;</span>, <span class="ruby-string">&#39;created_at&#39;</span>, <span class="ruby-string">&#39;updated_at&#39;</span>)
    .<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">reject</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:blank?</span>).<span class="ruby-identifier">empty?</span> }

  <span class="ruby-identifier">activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">create</span>(
    <span class="ruby-identifier">store</span><span class="ruby-operator">:</span> <span class="ruby-identifier">current_store</span>,
    <span class="ruby-identifier">user</span><span class="ruby-operator">:</span> <span class="ruby-identifier">current_user</span>,
    <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-identifier">action</span>,
    <span class="ruby-identifier">resource</span><span class="ruby-operator">:</span> <span class="ruby-identifier">resource</span>,
    <span class="ruby-identifier">context</span><span class="ruby-operator">:</span> <span class="ruby-identifier">context</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">resource</span>,
    <span class="ruby-identifier">differences</span><span class="ruby-operator">:</span> <span class="ruby-identifier">differences</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-user_shopping_cart" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_shopping_cart</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="user_shopping_cart-source">
            <pre><span class="ruby-comment"># File app/controllers/application_controller.rb, line 114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user_shopping_cart</span>
  <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">shopping_cart</span>(<span class="ruby-identifier">current_store</span>, <span class="ruby-identifier">current_hostname</span>.<span class="ruby-identifier">store_portal</span>, <span class="ruby-identifier">current_group</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.3.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

