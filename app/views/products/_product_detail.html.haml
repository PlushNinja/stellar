- cache_if current_user.guest?, [I18n.locale, :product_detail, product] do
  .product-header

    %h1.product-title
      = product.title
      %span.small= product.subtitle

    .product-meta
      .product-actions
        = render partial: 'products/actions', object: product, as: :product
      - if can_see_pricing? && can_shop? && may_shop_at?(@category)
        .product-pricing
          = render partial: 'products/pricing', object: product, as: :product

  .product-body

    .product-description

      %p.product-code
        - if product.customer_code.present?
          = icon('barcode', product.customer_code, class: 'fa-lg')
        = icon('barcode', product.code, class: 'fa-lg fa-flip-horizontal')

      - if can_see_stock?
        %p.product-stock
          = product_stock_string(product.stock)

      .body-text><= product.description.html_safe if product.description.present?

      - if product.variant?
        = render partial: 'products/variants_dropdown', object: product, as: :product

      = render partial: 'products/properties_components_table', object: product, as: :product

      - if product.images.document.any?
        .documents.list-group
          - product.images.document.each do |document|
            = link_to(icon('paperclip', document.to_s),
                document.url(:original), class: 'list-group-item')

    - if product.iframes.any?
      .iframes
        = render partial: 'iframes/gallery', object: product, as: :product, locals: {inline: current_store.inline_iframes}

    .images.technical
      - technicals = product.images.technical
      %ul.nav.nav-pills{role: 'tablist'}
        - if technicals.count > 1
          = render partial: 'images/pill', collection: technicals, as: :image
      .tab-content.gallery
        = render partial: 'images/technical', collection: technicals, as: :image
    .images.presentational
      - presentationals = product.images.presentational
      %ul.nav.nav-pills{role: 'tablist'}
        - if presentationals.count > 1
          = render partial: 'images/pill', collection: presentationals, as: :image
      .tab-content.gallery
        = render partial: 'images/presentational', collection: presentationals, as: :image

  .product-footer

    - if product.variant?
      .variant-products
        %ul= render partial: 'products/variant_product', collection: product.sibling_variants.live.sorted, as: :product, locals: {context: product}

    - if product.requisite_products.live.any?
      %h2= t('store.requisite_products')
      .requisite-products
        %ul= render partial: 'products/requisite_product', collection: product.requisite_products.live, as: :product
      = render partial: 'store/select_for_cart_modal', object: product, as: :product
